{"version":3,"file":"commonHelpers2.js","sources":["../src/js/shopping-page.js"],"sourcesContent":["import Pagination from 'tui-pagination';\nimport 'tui-pagination/dist/tui-pagination.css';\nimport { getBookByIds } from './booksAPI';\n\nconst refs = {\n  bookList: document.querySelector('.shopping-list-saved'),\n  emptyList: document.querySelector('.shopping-list-empty'),\n  pagination: document.querySelector('.tui-pagination'),\n};\nconst perPage = window.innerWidth >= 768 ? 3 : 4;\n\ncreateShoppingList();\n\nfunction getBooksStorage() {\n  const savedBooks = localStorage.getItem('shoppingIdList');\n  const bookIdArray = JSON.parse(savedBooks);\n  return bookIdArray;\n}\n\nasync function createShoppingList() {\n  const bookIds = getBooksStorage();\n  if (!bookIds || bookIds.length === 0) {\n    removeHidden(refs.emptyList);\n    setHidden(refs.pagination);\n  } else {\n    const booksArray = await getBookByIds(bookIds);\n\n    if (booksArray && booksArray.length !== 0) {\n      const chunkedArray = chunkArray(booksArray, perPage);\n      const currentPage = pagination.getCurrentPage();\n      renderBooks(chunkedArray[currentPage - 1]);\n      removeHidden(refs.pagination);\n\n      document\n        .querySelectorAll('.saved-item-delete-btn')\n        .forEach(btn => btn.addEventListener('click', removeBookFromStorage));\n    }\n  }\n}\n\nfunction shoppingListMarkup(books) {\n  return books\n    .map(\n      ({\n        _id,\n        book_image,\n        title,\n        list_name,\n        description,\n        author,\n        buy_links,\n      }) => {\n        const shopHrefs = buy_links.reduce((acc, item) => {\n          if (item.name === 'Amazon') {\n            acc.amazon = item.url;\n          }\n          if (item.name === 'Apple Books') {\n            acc.apple = item.url;\n          }\n          return acc;\n        }, {});\n\n        return `<li class=\"saved-item\">\n      <div class=\"saved-item-cover\">\n        <img\n          class=\"saved-item-cover-img\"\n          src=\"${book_image}\"\n          alt=\"${title}\"\n        />\n      </div>\n      <div class=\"saved-item-discription\">\n        <div class=\"saved-item-discription-top\">\n          <div class=\"saved-item-title-wrap\">\n            <h2 class=\"saved-item-title\">${title}</h2>\n            <p class=\"saved-item-genre\">${list_name}</p>\n          </div>\n          <button class=\"saved-item-delete-btn\" data-id=${_id}>\n            <img\n              class=\"delete-btn-img\"\n              src=\"./img/shopping list/trash-03.svg\"\n              alt=\"delete button\"\n            />\n          </button>\n        </div>\n        <p class=\"saved-item-short\">\n          ${description}\n        </p>\n        <div class=\"saved-item-wrap-bottom\">\n          <p class=\"saved-item-author\">${author}</p>\n          <ul class=\"saved-item-refer-list\">\n            <li class=\"saved-item-refer-item\">\n              <a\n                href=\"${shopHrefs.amazon}\"\n                class=\"saved-item-refer-item-link\"\n                target=\"_blank\"\n              >\n                <svg\n                  class=\"saved-item-refer-amazon-logo\"\n                  width=\"62\"\n                  height=\"19\"\n                >\n                  <use href=\"../img/modal/modal-icons.svg#icon-amazon-logo\"></use>\n                </svg>\n              </a>\n            </li>\n            <li class=\"saved-item-refer-item\">\n              <a\n                href=\"${shopHrefs.apple}\"\n                class=\"saved-item-refer-item-link\"\n                target=\"_blank\"\n              >\n                <svg\n                  class=\"saved-item-refer-ibooks-logo\"\n                  width=\"16\"\n                  height=\"16\"\n                >\n                  <use href=\"../img/modal/modal-icons.svg#icon-ibooks-logo\"></use>\n                </svg>\n              </a>\n            </li>\n          </ul>\n        </div>\n      </div>\n    </li>`;\n      }\n    )\n    .join('');\n}\n\nfunction renderBooks(books) {\n  const markup = shoppingListMarkup(books);\n  refs.bookList.insertAdjacentHTML('beforeend', markup);\n}\n\nfunction setHidden(el) {\n  el.classList.add('is-hidden');\n}\n\nfunction removeHidden(el) {\n  el.classList.remove('is-hidden');\n}\n\nfunction removeBookFromStorage(e) {\n  const id = e.currentTarget.dataset.id;\n  const bookIds = getBooksStorage();\n  const filtredBooks = bookIds.filter(bookId => id !== bookId);\n  localStorage.setItem('shoppingIdList', JSON.stringify(filtredBooks));\n  refs.bookList.innerHTML = '';\n  pagination.setTotalItems(getBooksStorage().length);\n  pagination.movePageTo(pagination.getCurrentPage());\n}\n\nconst container = document.getElementById('pagination');\n\nconst options = {\n  totalItems: getBooksStorage().length,\n  itemsPerPage: perPage,\n  visiblePages: 2,\n  page: 1,\n  centerAlign: true,\n  firstItemClassName: 'tui-first-child',\n  lastItemClassName: 'tui-last-child',\n  template: {\n    page: '<a href=\"#\" class=\"tui-page-btn\">{{page}}</a>',\n    currentPage:\n      '<strong class=\"tui-page-btn tui-is-selected\">{{page}}</strong>',\n    moveButton:\n      '<a href=\"#\" class=\"tui-page-btn tui-{{type}}\">' +\n      '<span class=\"tui-ico-{{type}}\">{{type}}</span>' +\n      '</a>',\n    disabledMoveButton:\n      '<span class=\"tui-page-btn tui-is-disabled tui-{{type}}\">' +\n      '<span class=\"tui-ico-{{type}}\">{{type}}</span>' +\n      '</span>',\n    moreButton:\n      '<a href=\"#\" class=\"tui-page-btn tui-{{type}}-is-ellip\">' +\n      '<span class=\"tui-ico-ellip\">...</span>' +\n      '</a>',\n  },\n};\n\nconst pagination = new Pagination(container, options);\n\npagination.on('afterMove', ({ page }) => {\n  refs.bookList.innerHTML = '';\n  createShoppingList();\n});\n\nfunction chunkArray(arr, chunkSize) {\n  let chunkedArray = [];\n  for (let i = 0; i < arr.length; i += chunkSize) {\n    chunkedArray.push(arr.slice(i, i + chunkSize));\n  }\n  return chunkedArray;\n}\n"],"names":["refs","perPage","createShoppingList","getBooksStorage","savedBooks","bookIds","removeHidden","setHidden","booksArray","getBookByIds","chunkedArray","chunkArray","currentPage","pagination","renderBooks","btn","removeBookFromStorage","shoppingListMarkup","books","_id","book_image","title","list_name","description","author","buy_links","shopHrefs","acc","item","markup","el","id","filtredBooks","bookId","container","options","Pagination","page","arr","chunkSize","i"],"mappings":"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"}